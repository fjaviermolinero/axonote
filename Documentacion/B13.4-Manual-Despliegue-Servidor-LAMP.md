# B13.4 - Manual de Despliegue AxoNote en Servidor LAMP

## üìã Resumen

Este manual proporciona instrucciones detalladas paso a paso para desplegar **AxoNote** (plataforma PWA de transcripci√≥n m√©dica) en un servidor LAMP (Linux, Apache, MySQL/PostgreSQL, PHP). AxoNote es una aplicaci√≥n completa que incluye backend FastAPI, frontend Next.js, procesamiento de IA para transcripci√≥n, y m√∫ltiples servicios de soporte.

## ‚ö†Ô∏è Nota Importante

**AxoNote no es una aplicaci√≥n PHP tradicional**. Es una aplicaci√≥n moderna que combina:
- **Backend**: FastAPI (Python) con Celery workers
- **Frontend**: Next.js (Node.js) PWA
- **Base de datos**: PostgreSQL (recomendado) o MySQL
- **Servicios**: Redis, MinIO, servicios de IA (Whisper, LLM)

Para un **despliegue completo y funcional**, se recomienda usar **Docker** o **contenedores**. Sin embargo, este manual cubre la instalaci√≥n manual en servidor LAMP.

---

## üéØ Arquitectura de AxoNote

### **Componentes Principales**
1. **API Backend** (FastAPI + Python 3.11)
2. **Frontend PWA** (Next.js 14 + TypeScript)
3. **Base de Datos** (PostgreSQL 15)
4. **Cache/Broker** (Redis 7)
5. **Almacenamiento** (MinIO/S3)
6. **Workers** (Celery para procesamiento as√≠ncrono)
7. **IA/ML** (Whisper, Diarizaci√≥n, LLM local)

### **Flujo de Datos**
```
Usuario ‚Üí Frontend PWA ‚Üí API FastAPI ‚Üí Celery Workers ‚Üí IA/ML ‚Üí Base de Datos ‚Üí MinIO
```

---

## üîß Requisitos del Sistema

### **Hardware M√≠nimo**
- **CPU**: 8 cores (recomendado 16+ para IA)
- **RAM**: 16GB (recomendado 32GB+ para modelos IA)
- **GPU**: NVIDIA RTX 4090 o superior (para Whisper/LLM local)
- **Almacenamiento**: 500GB SSD (1TB+ recomendado)
- **Ancho de banda**: 100Mbps estable

### **Software Base**
- **OS**: Ubuntu 22.04 LTS o superior
- **Python**: 3.11+
- **Node.js**: 18+
- **PostgreSQL**: 15+
- **Redis**: 7+
- **Apache**: 2.4+
- **Git**: 2.3+

### **Dependencias del Sistema**
```bash
# Audio/Video processing
ffmpeg
tesseract-ocr
tesseract-ocr-ita
tesseract-ocr-eng

# Compilaci√≥n
build-essential
python3-dev
libffi-dev
libssl-dev
pkg-config

# CUDA (para GPU NVIDIA)
nvidia-driver-535
nvidia-cuda-toolkit
```

---

## üì¶ Fase 1: Preparaci√≥n del Servidor

### **1.1 Actualizar el Sistema**
```bash
sudo apt update && sudo apt upgrade -y
sudo apt install -y curl wget unzip git
```

### **1.2 Instalar Apache**
```bash
sudo apt install -y apache2
sudo systemctl enable apache2
sudo systemctl start apache2

# Habilitar m√≥dulos necesarios
sudo a2enmod rewrite
sudo a2enmod ssl
sudo a2enmod proxy
sudo a2enmod proxy_http
sudo a2enmod headers
sudo systemctl restart apache2
```

### **1.3 Instalar PostgreSQL**
```bash
# Instalar PostgreSQL 15
sudo apt install -y postgresql-15 postgresql-contrib-15

# Configurar PostgreSQL
sudo systemctl enable postgresql
sudo systemctl start postgresql

# Crear base de datos y usuario
sudo -u postgres psql << EOF
CREATE DATABASE axonote;
CREATE USER axonote_user WITH PASSWORD 'CAMBIAR_PASSWORD_SEGURO';
GRANT ALL PRIVILEGES ON DATABASE axonote TO axonote_user;
ALTER USER axonote_user CREATEDB;
\q
EOF
```

### **1.4 Instalar Redis**
```bash
sudo apt install -y redis-server

# Configurar Redis
sudo systemctl enable redis-server
sudo systemctl start redis-server

# Verificar instalaci√≥n
redis-cli ping
# Debe responder: PONG
```

### **1.5 Instalar Python 3.11**
```bash
sudo apt install -y software-properties-common
sudo add-apt-repository ppa:deadsnakes/ppa -y
sudo apt update
sudo apt install -y python3.11 python3.11-venv python3.11-dev python3-pip

# Instalar Poetry para gesti√≥n de dependencias
curl -sSL https://install.python-poetry.org | python3 -
echo 'export PATH="$HOME/.local/bin:$PATH"' >> ~/.bashrc
source ~/.bashrc
```

### **1.6 Instalar Node.js 18**
```bash
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs

# Verificar instalaci√≥n
node --version  # debe ser v18.x.x
npm --version
```

### **1.7 Instalar Dependencias de IA**
```bash
# FFmpeg para procesamiento de audio
sudo apt install -y ffmpeg

# Tesseract OCR
sudo apt install -y tesseract-ocr tesseract-ocr-ita tesseract-ocr-eng

# Dependencias de compilaci√≥n
sudo apt install -y build-essential python3-dev libffi-dev libssl-dev pkg-config
```

### **1.8 Configurar GPU NVIDIA (Opcional)**
```bash
# Solo si tienes GPU NVIDIA para IA local
sudo apt install -y nvidia-driver-535 nvidia-cuda-toolkit

# Verificar instalaci√≥n GPU
nvidia-smi
```

---

## üìÅ Fase 2: Descarga y Configuraci√≥n del Proyecto

### **2.1 Crear Usuario del Sistema**
```bash
sudo adduser axonote
sudo usermod -aG sudo axonote
sudo su - axonote
```

### **2.2 Crear Estructura de Directorios**
```bash
mkdir -p /home/axonote/{app,logs,data,uploads,backups}
cd /home/axonote/app
```

### **2.3 Clonar el Proyecto**
```bash
# Sustituir con la URL real del repositorio
git clone https://github.com/tu-organizacion/axonote.git .

# Verificar estructura
ls -la
# Debe mostrar: apps/, docker/, scripts/, Documentacion/, etc.
```

### **2.4 Configurar Variables de Entorno**
```bash
# Copiar archivo de ejemplo
cp env.example .env

# Editar configuraci√≥n
nano .env
```

**Configuraci√≥n b√°sica del archivo `.env`:**
```bash
# ==============================================
# CONFIGURACI√ìN SERVIDOR LAMP - AXONOTE
# ==============================================

# Aplicaci√≥n
APP_ENV=production
SECRET_KEY=GENERAR_CLAVE_SEGURA_AQUI_256_BITS
API_PORT=8000
API_HOST=127.0.0.1
CORS_ORIGINS=https://tu-dominio.com,https://www.tu-dominio.com

# Base de Datos
DATABASE_URL=postgresql+psycopg://axonote_user:TU_PASSWORD_SEGURO@localhost:5432/axonote
DATABASE_ECHO=false

# Redis
REDIS_URL=redis://localhost:6379/0
CELERY_BROKER_URL=redis://localhost:6379/0
CELERY_RESULT_BACKEND=redis://localhost:6379/1

# Almacenamiento Local (simulando MinIO)
STORAGE_BACKEND=local
LOCAL_STORAGE_PATH=/home/axonote/uploads
MINIO_BUCKET=recordings

# Logging
LOG_LEVEL=INFO
LOG_FORMAT=json
LOG_FILE=/home/axonote/logs/axonote.log

# Seguridad
RATE_LIMIT_PER_MINUTE=60
MAX_UPLOAD_SIZE_MB=500
ALLOWED_AUDIO_FORMATS=wav,mp3,m4a,flac,ogg

# IA/ML (configurar seg√∫n disponibilidad)
WHISPER_MODEL=base  # tiny,base,small,medium,large-v3
WHISPER_DEVICE=cpu  # cuda si tienes GPU
USE_WHISPERX=false  # true si tienes GPU potente
HF_TOKEN=  # Token de Hugging Face (opcional)

# LLM Local (opcional)
LLM_PROVIDER=openai  # usar OpenAI como fallback
OPENAI_API_KEY=tu_api_key_openai
OPENAI_MODEL=gpt-4o-mini
OPENAI_MAX_MONTHLY_COST=25.0

# Features habilitadas
FEATURE_OCR=true
FEATURE_TTS=true
FEATURE_BATCH_REPROCESS=true
ENABLE_MEDICAL_RESEARCH=true

# Fuentes m√©dicas
ALLOWED_MEDICAL_SOURCES=who.int,ecdc.europa.eu,cdc.gov,nih.gov,pubmed.ncbi.nlm.nih.gov

# Idiomas
DEFAULT_SOURCE_LANGUAGE=it
OUTPUT_LANGUAGE=es
SUPPORTED_LANGUAGES=it,en,es
```

### **2.5 Generar Clave Secreta**
```bash
# Generar clave secreta segura
python3 -c "import secrets; print(secrets.token_urlsafe(32))"
# Usar el resultado en SECRET_KEY del .env
```

---

## ‚öôÔ∏è Fase 3: Instalaci√≥n del Backend (FastAPI)

### **3.1 Preparar Entorno Python**
```bash
cd /home/axonote/app/apps/api

# Crear entorno virtual
python3.11 -m venv venv
source venv/bin/activate

# Actualizar pip
pip install --upgrade pip setuptools wheel
```

### **3.2 Instalar Dependencias**
```bash
# Instalar Poetry en el venv
pip install poetry

# Instalar dependencias del proyecto
poetry install --no-dev  # Solo dependencias de producci√≥n

# Para IA/ML (opcional, solo si tienes GPU/CPU potente)
# poetry install --with ml
```

### **3.3 Configurar Base de Datos**
```bash
# Aplicar migraciones
source venv/bin/activate
cd /home/axonote/app/apps/api

# Ejecutar migraciones
alembic upgrade head

# Verificar conexi√≥n a BD
python -c "
from app.core.config import settings
print('Configuraci√≥n DB:', settings.DATABASE_URL)
"
```

### **3.4 Crear Script de Inicio del API**
```bash
# Crear script de inicio
cat > /home/axonote/start_api.sh << 'EOF'
#!/bin/bash
cd /home/axonote/app/apps/api
source venv/bin/activate
export $(cat ../../.env | xargs)
uvicorn app.main:app --host 127.0.0.1 --port 8000 --workers 4
EOF

chmod +x /home/axonote/start_api.sh
```

### **3.5 Crear Servicio Systemd para API**
```bash
sudo tee /etc/systemd/system/axonote-api.service << 'EOF'
[Unit]
Description=AxoNote FastAPI Service
After=network.target postgresql.service redis.service

[Service]
Type=exec
User=axonote
Group=axonote
WorkingDirectory=/home/axonote/app/apps/api
Environment=PATH=/home/axonote/app/apps/api/venv/bin
EnvironmentFile=/home/axonote/app/.env
ExecStart=/home/axonote/app/apps/api/venv/bin/uvicorn app.main:app --host 127.0.0.1 --port 8000 --workers 4
Restart=always
RestartSec=3

[Install]
WantedBy=multi-user.target
EOF

sudo systemctl daemon-reload
sudo systemctl enable axonote-api
```

---

## üîß Fase 4: Configuraci√≥n de Workers (Celery)

### **4.1 Crear Script de Workers**
```bash
cat > /home/axonote/start_worker.sh << 'EOF'
#!/bin/bash
cd /home/axonote/app/apps/api
source venv/bin/activate
export $(cat ../../.env | xargs)
celery -A app.workers.celery_app worker --loglevel=info --concurrency=2
EOF

chmod +x /home/axonote/start_worker.sh
```

### **4.2 Crear Servicio Systemd para Worker**
```bash
sudo tee /etc/systemd/system/axonote-worker.service << 'EOF'
[Unit]
Description=AxoNote Celery Worker
After=network.target redis.service axonote-api.service

[Service]
Type=exec
User=axonote
Group=axonote
WorkingDirectory=/home/axonote/app/apps/api
Environment=PATH=/home/axonote/app/apps/api/venv/bin
EnvironmentFile=/home/axonote/app/.env
ExecStart=/home/axonote/app/apps/api/venv/bin/celery -A app.workers.celery_app worker --loglevel=info --concurrency=2
Restart=always
RestartSec=5

[Install]
WantedBy=multi-user.target
EOF

sudo systemctl daemon-reload
sudo systemctl enable axonote-worker
```

---

## üåê Fase 5: Instalaci√≥n del Frontend (Next.js)

### **5.1 Preparar Frontend**
```bash
cd /home/axonote/app/apps/web

# Instalar dependencias
npm ci --production

# Configurar variables de entorno del frontend
cat > .env.local << 'EOF'
NODE_ENV=production
NEXT_PUBLIC_API_URL=https://tu-dominio.com/api
NEXT_PUBLIC_APP_NAME=AxoNote
NEXT_PUBLIC_APP_VERSION=1.0.0
EOF
```

### **5.2 Build del Frontend**
```bash
# Construir aplicaci√≥n para producci√≥n
npm run build

# Verificar build exitoso
ls -la .next/
```

### **5.3 Crear Script de Inicio Frontend**
```bash
cat > /home/axonote/start_web.sh << 'EOF'
#!/bin/bash
cd /home/axonote/app/apps/web
export NODE_ENV=production
npm start
EOF

chmod +x /home/axonote/start_web.sh
```

### **5.4 Crear Servicio Systemd para Frontend**
```bash
sudo tee /etc/systemd/system/axonote-web.service << 'EOF'
[Unit]
Description=AxoNote Next.js Frontend
After=network.target

[Service]
Type=exec
User=axonote
Group=axonote
WorkingDirectory=/home/axonote/app/apps/web
Environment=NODE_ENV=production
Environment=NEXT_PUBLIC_API_URL=https://tu-dominio.com/api
ExecStart=/usr/bin/npm start
Restart=always
RestartSec=3

[Install]
WantedBy=multi-user.target
EOF

sudo systemctl daemon-reload
sudo systemctl enable axonote-web
```

---

## üåç Fase 6: Configuraci√≥n de Apache

### **6.1 Crear VirtualHost**
```bash
sudo tee /etc/apache2/sites-available/axonote.conf << 'EOF'
<VirtualHost *:80>
    ServerName tu-dominio.com
    ServerAlias www.tu-dominio.com
    
    # Redirecci√≥n a HTTPS
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]
</VirtualHost>

<VirtualHost *:443>
    ServerName tu-dominio.com
    ServerAlias www.tu-dominio.com
    
    # SSL Configuration (configurar certificados)
    SSLEngine on
    SSLCertificateFile /etc/ssl/certs/tu-dominio.crt
    SSLCertificateKeyFile /etc/ssl/private/tu-dominio.key
    
    # Security Headers
    Header always set X-Frame-Options DENY
    Header always set X-Content-Type-Options nosniff
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    
    # Proxy para API Backend (FastAPI)
    ProxyPreserveHost On
    ProxyRequests Off
    
    # API routes -> FastAPI backend
    ProxyPass /api/ http://127.0.0.1:8000/
    ProxyPassReverse /api/ http://127.0.0.1:8000/
    
    # Health checks
    ProxyPass /health http://127.0.0.1:8000/health
    ProxyPassReverse /health http://127.0.0.1:8000/health
    
    # Todo lo dem√°s -> Next.js frontend
    ProxyPass / http://127.0.0.1:3000/
    ProxyPassReverse / http://127.0.0.1:3000/
    
    # WebSocket support para Next.js dev (si necesario)
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/?(.*) "ws://127.0.0.1:3000/$1" [P,L]
    
    # Static files caching
    <LocationMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$">
        ExpiresActive On
        ExpiresDefault "access plus 1 month"
        Header append Cache-Control "public"
    </LocationMatch>
    
    # PWA files
    <LocationMatch "\.(json|webmanifest)$">
        Header set Cache-Control "no-cache"
    </LocationMatch>
    
    # Logs
    CustomLog ${APACHE_LOG_DIR}/axonote_access.log combined
    ErrorLog ${APACHE_LOG_DIR}/axonote_error.log
    LogLevel warn
</VirtualHost>
EOF
```

### **6.2 Habilitar Sitio y SSL**
```bash
# Habilitar m√≥dulos SSL
sudo a2enmod ssl
sudo a2enmod headers
sudo a2enmod expires

# Habilitar sitio
sudo a2ensite axonote.conf
sudo a2dissite 000-default.conf

# Test configuraci√≥n
sudo apache2ctl configtest

# Reiniciar Apache
sudo systemctl restart apache2
```

### **6.3 Configurar SSL con Let's Encrypt**
```bash
# Instalar Certbot
sudo apt install -y certbot python3-certbot-apache

# Obtener certificado SSL
sudo certbot --apache -d tu-dominio.com -d www.tu-dominio.com

# Configurar renovaci√≥n autom√°tica
sudo crontab -e
# A√±adir l√≠nea:
# 0 12 * * * /usr/bin/certbot renew --quiet
```

---

## üóÇÔ∏è Fase 7: Configuraci√≥n de Almacenamiento

### **7.1 Crear Directorios de Almacenamiento**
```bash
sudo mkdir -p /var/axonote/{uploads,models,temp,logs}
sudo chown -R axonote:axonote /var/axonote
sudo chmod -R 755 /var/axonote

# Crear enlaces simb√≥licos
ln -s /var/axonote/uploads /home/axonote/uploads
ln -s /var/axonote/logs /home/axonote/logs
```

### **7.2 Configurar Logrotate**
```bash
sudo tee /etc/logrotate.d/axonote << 'EOF'
/home/axonote/logs/*.log {
    daily
    missingok
    rotate 52
    compress
    delaycompress
    notifempty
    copytruncate
    create 644 axonote axonote
}
EOF
```

### **7.3 Configurar Backup Autom√°tico**
```bash
cat > /home/axonote/backup.sh << 'EOF'
#!/bin/bash
BACKUP_DIR="/home/axonote/backups"
DATE=$(date +%Y%m%d_%H%M%S)

# Backup base de datos
pg_dump -h localhost -U axonote_user axonote > "$BACKUP_DIR/db_$DATE.sql"

# Backup archivos de uploads
tar -czf "$BACKUP_DIR/uploads_$DATE.tar.gz" /var/axonote/uploads/

# Limpiar backups antiguos (m√°s de 30 d√≠as)
find "$BACKUP_DIR" -name "*.sql" -mtime +30 -delete
find "$BACKUP_DIR" -name "*.tar.gz" -mtime +30 -delete

echo "Backup completado: $DATE"
EOF

chmod +x /home/axonote/backup.sh

# Programar backup diario
(crontab -l 2>/dev/null; echo "0 2 * * * /home/axonote/backup.sh") | crontab -
```

---

## üöÄ Fase 8: Inicio y Verificaci√≥n

### **8.1 Iniciar Servicios**
```bash
# Iniciar servicios de base
sudo systemctl start postgresql
sudo systemctl start redis-server

# Iniciar servicios de AxoNote
sudo systemctl start axonote-api
sudo systemctl start axonote-worker
sudo systemctl start axonote-web

# Verificar estados
sudo systemctl status axonote-api
sudo systemctl status axonote-worker
sudo systemctl status axonote-web
```

### **8.2 Verificar API Backend**
```bash
# Test de salud del API
curl -s http://localhost:8000/health/simple
# Debe devolver: {"status": "healthy"}

# Test completo
curl -s http://localhost:8000/health/detailed | jq .
```

### **8.3 Verificar Frontend**
```bash
# Test del frontend
curl -s http://localhost:3000 | head -n 5
```

### **8.4 Verificar Acceso Web**
```bash
# Test del sitio completo
curl -k https://tu-dominio.com/health
```

### **8.5 Monitorear Logs**
```bash
# Logs en tiempo real
tail -f /home/axonote/logs/axonote.log

# Logs de servicios
sudo journalctl -u axonote-api -f
sudo journalctl -u axonote-worker -f
sudo journalctl -u axonote-web -f
```

---

## üîß Fase 9: Configuraci√≥n Opcional de IA

### **9.1 Instalar Modelos de Whisper (Opcional)**
```bash
cd /var/axonote/models

# Descargar modelos Whisper
python3 -c "
import whisper
whisper.load_model('base')  # o 'small', 'medium', 'large-v3'
"
```

### **9.2 Configurar LLM Local (Opcional)**
```bash
# Solo si tienes GPU potente
# Instalar Ollama
curl -fsSL https://ollama.ai/install.sh | sh

# Descargar modelo Qwen2.5
ollama pull qwen2.5:14b

# Actualizar .env para usar Ollama
# LLM_PROVIDER=ollama
# OLLAMA_BASE_URL=http://localhost:11434
```

---

## üìä Fase 10: Monitoring y Mantenimiento

### **10.1 Script de Monitoreo**
```bash
cat > /home/axonote/monitor.sh << 'EOF'
#!/bin/bash
echo "=== AxoNote System Status ==="
echo "Fecha: $(date)"
echo

echo "=== Servicios ==="
systemctl is-active postgresql redis-server axonote-api axonote-worker axonote-web

echo -e "\n=== Uso de Recursos ==="
echo "CPU: $(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | awk -F'%' '{print $1}')%"
echo "RAM: $(free | grep Mem | awk '{printf "%.1f%%", $3/$2 * 100.0}')"
echo "Disco: $(df -h /home/axonote | awk 'NR==2{printf "%s", $5}')"

echo -e "\n=== Salud API ==="
curl -s http://localhost:8000/health/simple || echo "API no responde"

echo -e "\n=== Logs Recientes ==="
tail -n 5 /home/axonote/logs/axonote.log
EOF

chmod +x /home/axonote/monitor.sh
```

### **10.2 Configurar Alertas**
```bash
# Crear script de alerta simple
cat > /home/axonote/check_health.sh << 'EOF'
#!/bin/bash
if ! curl -s http://localhost:8000/health/simple > /dev/null; then
    echo "AxoNote API est√° ca√≠do - $(date)" | mail -s "Alerta AxoNote" admin@tu-dominio.com
    sudo systemctl restart axonote-api
fi
EOF

chmod +x /home/axonote/check_health.sh

# Ejecutar cada 5 minutos
(crontab -l 2>/dev/null; echo "*/5 * * * * /home/axonote/check_health.sh") | crontab -
```

---

## üõ°Ô∏è Fase 11: Seguridad y Hardening

### **11.1 Configurar Firewall**
```bash
sudo ufw enable
sudo ufw default deny incoming
sudo ufw default allow outgoing

# Puertos necesarios
sudo ufw allow 22    # SSH
sudo ufw allow 80    # HTTP
sudo ufw allow 443   # HTTPS

# PostgreSQL y Redis solo local
sudo ufw allow from 127.0.0.1 to any port 5432
sudo ufw allow from 127.0.0.1 to any port 6379
```

### **11.2 Configurar Fail2ban**
```bash
sudo apt install -y fail2ban

sudo tee /etc/fail2ban/jail.local << 'EOF'
[DEFAULT]
bantime = 3600
findtime = 600
maxretry = 3

[sshd]
enabled = true

[apache-auth]
enabled = true

[apache-badbots]
enabled = true

[apache-noscript]
enabled = true

[apache-overflows]
enabled = true
EOF

sudo systemctl enable fail2ban
sudo systemctl start fail2ban
```

### **11.3 Configurar Permisos**
```bash
# Asegurar permisos de archivos
sudo chown -R axonote:axonote /home/axonote/app
sudo chmod -R 755 /home/axonote/app
sudo chmod 600 /home/axonote/app/.env

# Configurar sudoers para usuario axonote
sudo tee /etc/sudoers.d/axonote << 'EOF'
axonote ALL=(ALL) NOPASSWD: /bin/systemctl restart axonote-api
axonote ALL=(ALL) NOPASSWD: /bin/systemctl restart axonote-worker
axonote ALL=(ALL) NOPASSWD: /bin/systemctl restart axonote-web
axonote ALL=(ALL) NOPASSWD: /bin/systemctl status axonote-*
EOF
```

---

## üìù Comandos de Mantenimiento

### **Reiniciar Servicios**
```bash
# Reiniciar solo API
sudo systemctl restart axonote-api

# Reiniciar worker
sudo systemctl restart axonote-worker

# Reiniciar frontend
sudo systemctl restart axonote-web

# Reiniciar todo AxoNote
sudo systemctl restart axonote-api axonote-worker axonote-web
```

### **Actualizar Aplicaci√≥n**
```bash
cd /home/axonote/app

# Hacer backup antes de actualizar
./backup.sh

# Actualizar c√≥digo
git pull origin main

# Actualizar backend
cd apps/api
source venv/bin/activate
poetry install --no-dev
alembic upgrade head

# Actualizar frontend
cd ../web
npm ci --production
npm run build

# Reiniciar servicios
sudo systemctl restart axonote-api axonote-worker axonote-web
```

### **Ver Logs**
```bash
# Logs de aplicaci√≥n
tail -f /home/axonote/logs/axonote.log

# Logs de servicios
sudo journalctl -u axonote-api -f
sudo journalctl -u axonote-worker -f

# Logs de Apache
tail -f /var/log/apache2/axonote_error.log
```

### **Backup Manual**
```bash
# Ejecutar backup inmediato
/home/axonote/backup.sh

# Restaurar desde backup
pg_dump_date="20241211_140000"  # Cambiar por fecha real
psql -h localhost -U axonote_user axonote < "/home/axonote/backups/db_$pg_dump_date.sql"
```

---

## ‚ö†Ô∏è Troubleshooting

### **Problemas Comunes**

**1. API no responde**
```bash
# Verificar servicio
sudo systemctl status axonote-api

# Ver logs
sudo journalctl -u axonote-api -n 50

# Reiniciar
sudo systemctl restart axonote-api
```

**2. Error de base de datos**
```bash
# Verificar PostgreSQL
sudo systemctl status postgresql

# Conectar manualmente
psql -h localhost -U axonote_user axonote

# Verificar migraciones
cd /home/axonote/app/apps/api
source venv/bin/activate
alembic current
alembic upgrade head
```

**3. Frontend no carga**
```bash
# Verificar servicio
sudo systemctl status axonote-web

# Rebuild frontend
cd /home/axonote/app/apps/web
npm run build
sudo systemctl restart axonote-web
```

**4. Workers no procesan tareas**
```bash
# Verificar Redis
redis-cli ping

# Verificar worker
sudo systemctl status axonote-worker

# Ver colas de Celery
cd /home/axonote/app/apps/api
source venv/bin/activate
celery -A app.workers.celery_app inspect active
```

### **Comandos de Diagn√≥stico**
```bash
# Script completo de diagn√≥stico
/home/axonote/monitor.sh

# Verificar conectividad
curl -s http://localhost:8000/health/detailed | jq .

# Verificar espacio en disco
df -h

# Verificar memoria
free -h

# Verificar procesos de AxoNote
ps aux | grep -E "(uvicorn|celery|node)"
```

---

## ‚úÖ Checklist de Verificaci√≥n Final

### **Servicios Base**
- [ ] PostgreSQL funcionando
- [ ] Redis funcionando
- [ ] Apache funcionando con SSL

### **Servicios AxoNote**
- [ ] axonote-api activo y respondiendo
- [ ] axonote-worker procesando tareas
- [ ] axonote-web sirviendo contenido

### **Acceso Web**
- [ ] `https://tu-dominio.com` carga correctamente
- [ ] `https://tu-dominio.com/api/docs` muestra documentaci√≥n Swagger
- [ ] `https://tu-dominio.com/health` responde OK

### **Funcionalidades**
- [ ] Grabaci√≥n de audio funciona
- [ ] Upload de archivos funciona
- [ ] Procesamiento en background activo
- [ ] Logs gener√°ndose correctamente

### **Seguridad**
- [ ] HTTPS configurado
- [ ] Firewall configurado
- [ ] Fail2ban activo
- [ ] Backups programados

### **Monitoreo**
- [ ] Logs rotando correctamente
- [ ] Monitoring script funcionando
- [ ] Alertas configuradas (opcional)

---

## üéØ Conclusi√≥n

Este manual proporciona una instalaci√≥n completa de **AxoNote** en un servidor LAMP. La aplicaci√≥n estar√° disponible en `https://tu-dominio.com` con todas las funcionalidades de transcripci√≥n m√©dica, procesamiento de IA y gesti√≥n de datos.

### **Notas Importantes:**

1. **Rendimiento**: Para funcionalidades completas de IA (Whisper local, LLM), se recomienda GPU NVIDIA potente
2. **Escalabilidad**: Para m√∫ltiples usuarios concurrentes, considerar aumentar workers de Celery
3. **Backup**: Configurar backup externo para datos cr√≠ticos
4. **Monitoreo**: Implementar soluci√≥n de monitoreo profesional (Prometheus/Grafana) para producci√≥n

### **Soporte T√©cnico:**
- Documentaci√≥n completa en `/home/axonote/app/Documentacion/`
- Logs detallados en `/home/axonote/logs/`
- Scripts de mantenimiento en `/home/axonote/`

---

**Estado**: ‚úÖ **Manual Completo**  
**Fecha**: Septiembre 2025  
**Versi√≥n**: 1.0.0  
**Pr√≥xima Revisi√≥n**: Post-deployment en producci√≥n
