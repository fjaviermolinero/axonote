# B10.1 - Fase 10: Export Multi-Modal y TTS de Micro-Memos

## üìã Resumen de la Fase

La **Fase 10** implementa capacidades avanzadas de exportaci√≥n multi-modal y s√≠ntesis de voz (TTS) para micro-memos, completando el ecosistema de AxoNote como plataforma integral de educaci√≥n m√©dica. Esta fase permite exportar todo el contenido procesado (transcripciones, OCR, micro-memos) en m√∫ltiples formatos acad√©micos y profesionales, adem√°s de convertir micro-memos a audio para estudio auditivo.

### üéØ Objetivos Principales

1. **Sistema de Export Multi-Modal** - Exportaci√≥n unificada de contenido en 6 formatos especializados
2. **TTS de Micro-Memos** - S√≠ntesis de voz italiana para flashcards auditivas
3. **Templates Acad√©micos** - Formatos profesionales para documentaci√≥n m√©dica y estudio
4. **Batch Processing Avanzado** - Exportaci√≥n masiva con tracking de progreso
5. **Integraci√≥n Notion Completa** - Sincronizaci√≥n de exports y archivos de audio

## üèóÔ∏è Arquitectura de la Soluci√≥n

### **Pipeline de Export Multi-Modal**

```mermaid
graph TD
    A[Contenido Multi-Modal] --> B{Tipo de Export}
    B -->|PDF M√©dico| C[Template PDF Acad√©mico]
    B -->|DOCX| D[Template Word Profesional]
    B -->|JSON| E[Estructura API Completa]
    B -->|ANKI| F[Flashcards Anki Package]
    B -->|CSV| G[Dataset An√°lisis]
    B -->|HTML| H[Reporte Web Interactivo]
    
    C --> I[Post-procesamiento]
    D --> I
    E --> I
    F --> I
    G --> I
    H --> I
    
    I --> J[Compresi√≥n y Storage]
    J --> K[Sincronizaci√≥n Notion]
```

### **Pipeline TTS para Micro-Memos**

```mermaid
graph TD
    A[Micro-Memo Collection] --> B[An√°lisis de Contenido]
    B --> C[Pre-procesamiento Texto]
    C --> D[Detecci√≥n Terminolog√≠a M√©dica]
    D --> E[Normalizaci√≥n Pronunciaci√≥n]
    E --> F[S√≠ntesis TTS Piper]
    F --> G[Post-procesamiento Audio]
    G --> H[Metadatos y Compresi√≥n]
    H --> I[Storage MinIO]
    I --> J[Sincronizaci√≥n Notion]
```

### **Sistema de Templates Especializados**

```mermaid
graph TD
    A[Contenido Source] --> B{Template Engine}
    B -->|Medicina| C[Template M√©dico]
    B -->|Academia| D[Template Acad√©mico]
    B -->|Cl√≠nico| E[Template Cl√≠nico]
    B -->|Estudio| F[Template Flashcards]
    
    C --> G[PDF con Referencias]
    D --> H[DOCX Estructurado]
    E --> I[Reporte Cl√≠nico]
    F --> J[Anki + Audio TTS]
    
    G --> K[Export Completo]
    H --> K
    I --> K
    J --> K
```

## üéØ Funcionalidades Implementadas

### **1. Sistema de Export Multi-Modal Completo**

#### **6 Formatos de Export Especializados**

##### **PDF M√©dico Acad√©mico**
- **Template profesional** con header m√©dico y footer acad√©mico
- **Estructura jer√°rquica** (transcripciones ‚Üí OCR ‚Üí micro-memos ‚Üí research)
- **Referencias autom√°ticas** con enlaces a fuentes m√©dicas
- **√çndice navegable** con bookmarks y links internos
- **Metadatos completos** (clase, fecha, duraci√≥n, participantes)
- **Im√°genes integradas** (diagramas OCR, gr√°ficos de m√©tricas)
- **Formato A4** optimizado para impresi√≥n y digital

##### **DOCX Profesional**
- **Estilos Microsoft Word** m√©dicos con heading hierarchy
- **Tabla de contenidos** autom√°tica con numeraci√≥n
- **Headers y footers** personalizados por secci√≥n
- **Comentarios integrados** con observaciones m√©dicas
- **Track changes preparado** para revisi√≥n colaborativa
- **Formato APA** para referencias m√©dicas
- **Compatibilidad completa** con Word 2016+

##### **JSON Completo para APIs**
- **Estructura anidada** preservando relaciones
- **Metadatos exhaustivos** para cada elemento
- **Timestamps precisos** con zona horaria
- **M√©tricas de calidad** incluidas en cada secci√≥n
- **Formato REST** est√°ndar para integraciones
- **Validation schema** JSONSchema incluido
- **Compresi√≥n gzip** opcional para archivos grandes

##### **Anki Package (.apkg)**
- **Notas Anki nativas** con campos especializados m√©dicos
- **Media integrada** (audio TTS, im√°genes OCR)
- **Tags inteligentes** (especialidad, dificultad, tipo)
- **Spaced repetition configurado** con intervalos optimizados
- **Template CSS** m√©dico profesional
- **JavaScript interactivo** para funcionalidades avanzadas
- **Compatible Anki 2.1+** con extensiones m√©dicas

##### **CSV Dataset para An√°lisis**
- **Formato tabular** con todas las m√©tricas
- **Columnas normalizadas** para an√°lisis estad√≠stico
- **Encoding UTF-8** para t√©rminos m√©dicos italianos
- **Headers descriptivos** con unidades de medida
- **Separadores configurables** (coma, semicolon, tab)
- **Compatible Excel** y herramientas de an√°lisis
- **Metadatos en header** como comentarios

##### **HTML Reporte Interactivo**
- **Dashboard web** con navegaci√≥n por secciones
- **Gr√°ficos interactivos** (Chart.js, m√©tricas temporales)
- **Audio players** integrados para TTS y transcripciones
- **Responsive design** optimizado m√≥vil/desktop
- **Search functionality** en todo el contenido
- **Export secundario** (print CSS, PDF from HTML)
- **Offline functionality** con service worker

#### **Configuraci√≥n Avanzada de Export**

##### **Filtros Inteligentes**
```python
class FiltrosExport:
    # Filtros temporales
    fecha_inicio: Optional[datetime]
    fecha_fin: Optional[datetime]
    
    # Filtros de contenido
    incluir_transcripciones: bool = True
    incluir_ocr: bool = True
    incluir_micromemos: bool = True
    incluir_research: bool = True
    incluir_analytics: bool = False
    
    # Filtros de calidad
    confianza_minima: float = 0.7
    solo_validados: bool = False
    
    # Filtros especializados
    especialidades: List[str] = []
    niveles_dificultad: List[NivelDificultad] = []
    tipos_contenido: List[str] = []
    
    # Opciones de formato
    incluir_metadatos: bool = True
    incluir_imagenes: bool = True
    incluir_audio: bool = False
    comprimir_salida: bool = True
```

##### **Personalizaci√≥n de Templates**
```python
class ConfiguracionTemplate:
    # Identidad
    logo_institucional: Optional[str]
    header_personalizado: Optional[str]
    footer_personalizado: Optional[str]
    
    # Formato m√©dico
    incluir_disclaimer: bool = True
    formato_referencias: str = "apa"  # apa, vancouver, harvard
    estilo_medico: str = "clinico"  # clinico, academico, investigacion
    
    # Opciones espec√≠ficas
    tabla_contenidos: bool = True
    numeracion_paginas: bool = True
    watermark: Optional[str] = None
    confidencialidad: str = "medical"  # public, internal, medical, confidential
```

### **2. Sistema TTS M√©dico Especializado**

#### **Motor TTS Piper Optimizado**
- **Modelo italiano m√©dico** entrenado con terminolog√≠a especializada
- **Pronunciaci√≥n correcta** de t√©rminos m√©dicos latinos
- **Velocidad adaptable** (0.5x - 2.0x) para diferentes estilos de estudio
- **Calidad alta** (22kHz, 16-bit) para claridad m√°xima
- **Bajo consumo** optimizado para batch processing
- **SSML support** para √©nfasis y pausas m√©dicas

#### **Pre-procesamiento M√©dico del Texto**
```python
class NormalizadorTextoMedico:
    """Normaliza texto m√©dico para TTS √≥ptimo."""
    
    def normalizar_terminologia(self, texto: str) -> str:
        """Normaliza t√©rminos m√©dicos para pronunciaci√≥n correcta."""
        
    def expandir_abreviaturas(self, texto: str) -> str:
        """Expande abreviaturas m√©dicas (ECG ‚Üí elettrocardiogramma)."""
        
    def aplicar_pausas_naturales(self, texto: str) -> str:
        """A√±ade pausas SSML en puntos l√≥gicos."""
        
    def ajustar_enfasis_conceptos(self, texto: str) -> str:
        """Enfatiza conceptos clave con SSML."""
```

#### **Tipos de S√≠ntesis Especializada**

##### **TTS Individual de Micro-Memo**
- **Audio corto** (30-90 segundos) por flashcard
- **Estructura pregunta-pausa-respuesta** con timing optimizado
- **Metadata integrada** (t√≠tulo, tipo, dificultad)
- **Formato MP3** con compresi√≥n inteligente
- **Subt√≠tulos autom√°ticos** en formato SRT/VTT

##### **TTS de Colecci√≥n Completa**
- **Audio largo** (10-60 minutos) con toda la colecci√≥n
- **Separadores auditivos** entre micro-memos
- **√çndice de cap√≠tulos** para navegaci√≥n
- **Breaks programados** para spaced repetition
- **Control de velocidad** preservado en metadata

##### **TTS Modo Estudio Adaptativo**
- **Solo preguntas** para modo activo de repaso
- **Respuestas opcionales** con timing controlado
- **Dificultad progresiva** en orden de s√≠ntesis
- **Audio binaural** opcional para mejor concentraci√≥n
- **Integraci√≥n spaced repetition** con pausas calculadas

#### **Post-procesamiento de Audio**
```python
class ProcessorAudioTTS:
    """Post-procesa audio TTS para calidad √≥ptima."""
    
    def aplicar_filtros_medicos(self, audio: bytes) -> bytes:
        """Aplica filtros espec√≠ficos para claridad m√©dica."""
        
    def normalizar_volumen(self, audio: bytes) -> bytes:
        """Normaliza volumen para consistency entre memos."""
        
    def a√±adir_intro_outro(self, audio: bytes, memo: MicroMemo) -> bytes:
        """A√±ade intro/outro con contexto del memo."""
        
    def crear_capitulos(self, audios: List[bytes]) -> bytes:
        """Combina m√∫ltiples audios con separadores."""
```

### **3. Sistema de Batch Processing Avanzado**

#### **Processing Distribuido con Celery**
- **Worker pools especializados** (export-worker, tts-worker)
- **Queue prioritaria** para exports urgentes vs batch
- **Retry logic inteligente** con exponential backoff
- **Progress tracking** granular con percentage y ETA
- **Resource monitoring** para optimizar concurrencia
- **Cleanup autom√°tico** de archivos temporales

#### **Gesti√≥n de Memory y Storage**
```python
class GestorRecursosExport:
    """Gestiona recursos durante exports masivos."""
    
    def estimar_recursos_necesarios(
        self, 
        export_config: ConfiguracionExport
    ) -> RecursosEstimados:
        """Estima CPU, RAM y storage necesarios."""
        
    def optimizar_batch_size(
        self, 
        recursos_disponibles: RecursosDisponibles
    ) -> int:
        """Calcula batch size √≥ptimo seg√∫n recursos."""
        
    def monitorear_uso_recursos(self) -> MetricasRecursos:
        """Monitorea uso en tiempo real."""
```

#### **Sistema de Caching Inteligente**
- **Cache de templates** compilados para reutilizaci√≥n
- **Cache de modelos TTS** para evitar recarga
- **Cache de assets** (logos, im√°genes) por instituci√≥n
- **Cache de pronunciaci√≥n** m√©dica para TTS
- **TTL configurable** seg√∫n tipo de contenido
- **Invalidaci√≥n autom√°tica** cuando cambia fuente

### **4. Integraci√≥n Notion Extendida**

#### **Sincronizaci√≥n de Exports**
```python
class NotionExportSync:
    """Sincroniza exports con Notion."""
    
    async def sync_export_session(
        self, 
        export_session: ExportSession
    ) -> NotionPage:
        """Crea p√°gina de export con metadata completa."""
        
    async def attach_export_files(
        self, 
        notion_page: NotionPage,
        export_files: List[ExportFile]
    ) -> bool:
        """Adjunta archivos de export a p√°gina Notion."""
        
    async def create_export_dashboard(
        self, 
        class_session: ClassSession
    ) -> NotionDatabase:
        """Crea dashboard de exports por clase."""
```

#### **Templates Notion Especializados**

##### **Template Export Session**
```markdown
# üì§ Export Session - [NOMBRE]

## üìä Informaci√≥n General
- **Fecha Export**: [TIMESTAMP]
- **Formato**: [PDF/DOCX/JSON/ANKI/CSV/HTML]
- **Contenido**: [TIPOS_INCLUIDOS]
- **Estado**: [PROCESSING/COMPLETED/FAILED]

## üìã Configuraci√≥n
- **Filtros Aplicados**: [FILTROS]
- **Template Usado**: [TEMPLATE]
- **Tama√±o Final**: [SIZE]

## üìÅ Archivos Generados
- [ARCHIVO_1] - [TAMA√ëO] - [DOWNLOAD_LINK]
- [ARCHIVO_2] - [TAMA√ëO] - [DOWNLOAD_LINK]

## üìà M√©tricas de Export
- **Tiempo Procesamiento**: [DURATION]
- **Elementos Exportados**: [COUNT]
- **Calidad Promedio**: [SCORE]
```

##### **Template TTS Collection**
```markdown
# üéµ TTS Collection - [NOMBRE]

## üìä Informaci√≥n Audio
- **Duraci√≥n Total**: [DURATION]
- **N√∫mero de Memos**: [COUNT]
- **Calidad Audio**: [QUALITY]
- **Idioma**: [LANGUAGE]

## üéØ Configuraci√≥n TTS
- **Velocidad**: [SPEED]
- **Voz**: [VOICE_MODEL]
- **Formato**: [FORMAT]
- **Modo**: [INDIVIDUAL/COLLECTION/STUDY]

## üìÅ Archivos de Audio
- [AUDIO_1] - [DURATION] - [PLAY_LINK]
- [AUDIO_2] - [DURATION] - [PLAY_LINK]

## üìö Memos Incluidos
- [MEMO_1] - [TYPE] - [DIFFICULTY]
- [MEMO_2] - [TYPE] - [DIFFICULTY]
```

## üìä Especificaciones T√©cnicas

### **Nuevos Modelos de Base de Datos**

#### **ExportSession**
```python
class ExportSession(Base):
    __tablename__ = "export_sessions"
    
    id: Mapped[UUID] = mapped_column(primary_key=True, default=uuid4)
    class_session_id: Mapped[UUID] = mapped_column(ForeignKey("class_sessions.id"))
    
    # Configuraci√≥n de export
    export_format: Mapped[ExportFormat] = mapped_column(String(50))
    template_name: Mapped[str] = mapped_column(String(100))
    filters_applied: Mapped[Dict[str, Any]] = mapped_column(JSON)
    
    # Estado y progreso
    status: Mapped[EstadoExport] = mapped_column(String(50))
    progress_percentage: Mapped[float] = mapped_column(default=0.0)
    estimated_completion: Mapped[Optional[datetime]]
    
    # Resultado
    output_files: Mapped[List[str]] = mapped_column(JSON)
    total_size_bytes: Mapped[int] = mapped_column(default=0)
    
    # M√©tricas
    processing_time_seconds: Mapped[float] = mapped_column(default=0.0)
    elements_exported: Mapped[int] = mapped_column(default=0)
    quality_score: Mapped[float] = mapped_column(default=0.0)
    
    # Timestamps
    created_at: Mapped[datetime] = mapped_column(default=datetime.utcnow)
    started_at: Mapped[Optional[datetime]]
    completed_at: Mapped[Optional[datetime]]
    
    # Relationships
    class_session: Mapped["ClassSession"] = relationship(back_populates="export_sessions")
    tts_results: Mapped[List["TTSResult"]] = relationship(back_populates="export_session")
```

#### **TTSResult**
```python
class TTSResult(Base):
    __tablename__ = "tts_results"
    
    id: Mapped[UUID] = mapped_column(primary_key=True, default=uuid4)
    export_session_id: Mapped[Optional[UUID]] = mapped_column(ForeignKey("export_sessions.id"))
    micro_memo_id: Mapped[Optional[UUID]] = mapped_column(ForeignKey("micro_memos.id"))
    collection_id: Mapped[Optional[UUID]] = mapped_column(ForeignKey("micro_memo_collections.id"))
    
    # Configuraci√≥n TTS
    text_content: Mapped[str] = mapped_column(Text)
    normalized_text: Mapped[str] = mapped_column(Text)  # Post-procesado para TTS
    voice_model: Mapped[str] = mapped_column(String(100))
    language: Mapped[str] = mapped_column(String(10), default="ita")
    speed_factor: Mapped[float] = mapped_column(default=1.0)
    
    # Resultado
    audio_file_path: Mapped[str] = mapped_column(String(500))
    audio_format: Mapped[str] = mapped_column(String(10), default="mp3")
    duration_seconds: Mapped[float] = mapped_column(default=0.0)
    file_size_bytes: Mapped[int] = mapped_column(default=0)
    
    # Calidad y m√©tricas
    synthesis_quality: Mapped[float] = mapped_column(default=0.0)
    processing_time: Mapped[float] = mapped_column(default=0.0)
    confidence_score: Mapped[float] = mapped_column(default=0.0)
    
    # Metadata TTS
    ssml_applied: Mapped[bool] = mapped_column(default=False)
    medical_pronunciation: Mapped[bool] = mapped_column(default=True)
    has_chapters: Mapped[bool] = mapped_column(default=False)
    chapter_markers: Mapped[Optional[List[Dict]]] = mapped_column(JSON)
    
    # Timestamps
    created_at: Mapped[datetime] = mapped_column(default=datetime.utcnow)
    
    # Relationships
    export_session: Mapped[Optional["ExportSession"]] = relationship(back_populates="tts_results")
    micro_memo: Mapped[Optional["MicroMemo"]] = relationship()
    collection: Mapped[Optional["MicroMemoCollection"]] = relationship()
```

### **Servicios Core**

#### **ExportService - Sistema Multi-Modal**
```python
class ExportService(BaseService):
    """Servicio de exportaci√≥n multi-modal."""
    
    async def create_export_session(
        self,
        class_session_id: UUID,
        export_format: ExportFormat,
        config: ConfiguracionExport
    ) -> ExportSession:
        """Crea nueva sesi√≥n de export."""
        
    async def export_to_pdf(
        self,
        export_session: ExportSession
    ) -> str:
        """Exporta a PDF m√©dico profesional."""
        
    async def export_to_docx(
        self,
        export_session: ExportSession
    ) -> str:
        """Exporta a Word formato acad√©mico."""
        
    async def export_to_anki(
        self,
        export_session: ExportSession
    ) -> str:
        """Crea package Anki con audio TTS."""
        
    async def export_to_json(
        self,
        export_session: ExportSession
    ) -> str:
        """Exporta estructura JSON completa."""
        
    async def export_to_csv(
        self,
        export_session: ExportSession
    ) -> str:
        """Crea dataset CSV para an√°lisis."""
        
    async def export_to_html(
        self,
        export_session: ExportSession
    ) -> str:
        """Genera reporte HTML interactivo."""
```

#### **TTSService - S√≠ntesis de Voz M√©dica**
```python
class TTSService(BaseService):
    """Servicio de s√≠ntesis de voz para contenido m√©dico."""
    
    async def synthesize_micro_memo(
        self,
        micro_memo: MicroMemo,
        config: ConfiguracionTTS
    ) -> TTSResult:
        """Sintetiza audio de micro-memo individual."""
        
    async def synthesize_collection(
        self,
        collection: MicroMemoCollection,
        config: ConfiguracionTTS
    ) -> TTSResult:
        """Sintetiza colecci√≥n completa con separadores."""
        
    async def synthesize_study_session(
        self,
        memos: List[MicroMemo],
        study_mode: StudyMode,
        config: ConfiguracionTTS
    ) -> TTSResult:
        """Sintetiza sesi√≥n de estudio con pausas."""
        
    def normalize_medical_text(
        self,
        text: str,
        language: str = "ita"
    ) -> str:
        """Normaliza texto m√©dico para TTS."""
        
    def apply_medical_pronunciation(
        self,
        text: str
    ) -> str:
        """Aplica reglas de pronunciaci√≥n m√©dica."""
```

### **Tareas Celery Especializadas**

#### **export_tts.py - Processing Distribuido**
```python
@celery_app.task(bind=True, name="process_export_session")
async def process_export_session_task(
    self,
    export_session_id: str,
    class_session_id: str
):
    """Procesa sesi√≥n de export completa."""
    
@celery_app.task(bind=True, name="synthesize_collection_tts")
async def synthesize_collection_tts_task(
    self,
    collection_id: str,
    tts_config: Dict[str, Any]
):
    """Sintetiza TTS de colecci√≥n de micro-memos."""
    
@celery_app.task(bind=True, name="create_anki_package")
async def create_anki_package_task(
    self,
    export_session_id: str,
    include_tts: bool = True
):
    """Crea package Anki con audio integrado."""
    
@celery_app.task(bind=True, name="batch_tts_synthesis")
async def batch_tts_synthesis_task(
    self,
    micro_memo_ids: List[str],
    batch_config: Dict[str, Any]
):
    """S√≠ntesis TTS masiva con optimizaci√≥n."""
```

### **APIs REST Completas**

#### **Endpoints Export (8 endpoints)**
```python
# POST /api/v1/export/create
async def create_export_session(
    class_session_id: UUID,
    config: ConfiguracionExport
) -> ExportSession

# GET /api/v1/export/session/{session_id}
async def get_export_session(session_id: UUID) -> ExportSession

# GET /api/v1/export/session/{session_id}/status
async def get_export_status(session_id: UUID) -> EstadoExport

# GET /api/v1/export/session/{session_id}/download/{file_name}
async def download_export_file(session_id: UUID, file_name: str) -> FileResponse

# GET /api/v1/export/class/{class_id}/history
async def get_export_history(class_id: UUID) -> List[ExportSession]

# POST /api/v1/export/batch
async def create_batch_export(
    class_session_ids: List[UUID],
    config: ConfiguracionExport
) -> BatchExportSession

# DELETE /api/v1/export/session/{session_id}
async def delete_export_session(session_id: UUID) -> bool

# GET /api/v1/export/health
async def export_health_check() -> Dict[str, Any]
```

#### **Endpoints TTS (6 endpoints)**
```python
# POST /api/v1/tts/memo/{memo_id}/synthesize
async def synthesize_memo_tts(
    memo_id: UUID,
    config: ConfiguracionTTS
) -> TTSResult

# POST /api/v1/tts/collection/{collection_id}/synthesize
async def synthesize_collection_tts(
    collection_id: UUID,
    config: ConfiguracionTTS
) -> TTSResult

# GET /api/v1/tts/result/{result_id}
async def get_tts_result(result_id: UUID) -> TTSResult

# GET /api/v1/tts/result/{result_id}/audio
async def stream_tts_audio(result_id: UUID) -> StreamingResponse

# GET /api/v1/tts/collection/{collection_id}/results
async def get_collection_tts_results(collection_id: UUID) -> List[TTSResult]

# GET /api/v1/tts/health
async def tts_health_check() -> Dict[str, Any]
```

## üîß Configuraci√≥n y Variables de Entorno

### **Variables Export (25+ variables)**

#### **Configuraci√≥n B√°sica Export**
```bash
# Export core
EXPORT_ENABLED=true
EXPORT_STORAGE_PATH=/app/data/exports
EXPORT_MAX_FILE_SIZE_MB=500
EXPORT_CONCURRENT_JOBS=3
EXPORT_CLEANUP_DAYS=30

# Formatos habilitados
EXPORT_FORMATS=pdf,docx,json,anki,csv,html
EXPORT_DEFAULT_FORMAT=pdf
EXPORT_COMPRESSION=true
EXPORT_QUALITY_THRESHOLD=0.8

# Templates
EXPORT_TEMPLATES_PATH=/app/templates/export
EXPORT_DEFAULT_TEMPLATE=medical_academic
EXPORT_LOGO_PATH=/app/assets/logo.png
EXPORT_CUSTOM_CSS_PATH=/app/assets/export.css
```

#### **Configuraci√≥n PDF/DOCX**
```bash
# PDF espec√≠fico
EXPORT_PDF_ENGINE=weasyprint          # weasyprint, reportlab
EXPORT_PDF_PAGE_SIZE=A4
EXPORT_PDF_MARGINS=20mm
EXPORT_PDF_BOOKMARKS=true
EXPORT_PDF_TOC=true
EXPORT_PDF_WATERMARK=false

# DOCX espec√≠fico
EXPORT_DOCX_TEMPLATE=medical_template.docx
EXPORT_DOCX_STYLES=medical_styles.xml
EXPORT_DOCX_TRACK_CHANGES=false
EXPORT_DOCX_PROTECTION=false
```

#### **Configuraci√≥n Anki**
```bash
# Anki package
EXPORT_ANKI_DECK_NAME=Axonote Medical
EXPORT_ANKI_NOTE_TYPE=medical_flashcard
EXPORT_ANKI_INCLUDE_TTS=true
EXPORT_ANKI_CSS_TEMPLATE=medical_anki.css
EXPORT_ANKI_MEDIA_QUALITY=high
```

### **Variables TTS (20+ variables)**

#### **Configuraci√≥n B√°sica TTS**
```bash
# TTS core
TTS_ENABLED=true
TTS_ENGINE=piper                      # piper, espeak, festival
TTS_LANGUAGE=it                       # Italiano principal
TTS_VOICE_MODEL=it_riccardo_quality   # Modelo italiano de calidad
TTS_QUALITY=high                      # low, medium, high
TTS_CONCURRENT_SYNTHESIS=2
```

#### **Configuraci√≥n Piper**
```bash
# Piper espec√≠fico
PIPER_MODEL_PATH=/app/models/piper
PIPER_CONFIG_PATH=/app/config/piper
PIPER_VOICE_IT_RICCARDO=/app/models/piper/it_riccardo.onnx
PIPER_VOICE_IT_MEDICAL=/app/models/piper/it_medical_custom.onnx
PIPER_CUDA_ENABLED=false              # CPU por defecto
PIPER_BATCH_SIZE=1
```

#### **Configuraci√≥n Audio**
```bash
# Audio output
TTS_AUDIO_FORMAT=mp3                  # mp3, wav, ogg
TTS_AUDIO_QUALITY=128kbps            # 64, 128, 192, 320
TTS_SAMPLE_RATE=22050                # Hz
TTS_MONO=true
TTS_NORMALIZE_VOLUME=true
TTS_FADE_IN_MS=50
TTS_FADE_OUT_MS=100
```

#### **Pre-procesamiento M√©dico**
```bash
# Normalizaci√≥n m√©dica
TTS_MEDICAL_DICT_PATH=/app/data/medical_dict_ita.txt
TTS_PRONUNCIATION_RULES=/app/config/medical_pronunciation.json
TTS_EXPAND_ABBREVIATIONS=true
TTS_SSML_ENABLED=true
TTS_EMPHASIS_KEYWORDS=true
TTS_PAUSE_BETWEEN_CONCEPTS=500       # ms
```

### **Variables Notion Extendidas**
```bash
# Export Notion sync
NOTION_SYNC_EXPORTS=true
NOTION_DB_EXPORT_SESSIONS=            # Database exports
NOTION_DB_TTS_RESULTS=               # Database TTS results
NOTION_ATTACH_FILES=true             # Adjuntar archivos a p√°ginas
NOTION_CREATE_DASHBOARDS=true       # Crear dashboards de exports

# Templates Notion
NOTION_TEMPLATE_EXPORT=export_session
NOTION_TEMPLATE_TTS=tts_collection
NOTION_MAX_FILE_SIZE_MB=50          # L√≠mite Notion
NOTION_BATCH_UPLOAD=true
```

## üìä Performance y M√©tricas Esperadas

### **Hardware Target: RTX 4090 24GB + Intel i9 14900K**

#### **Performance Export**
| Formato | Contenido (elementos) | Tiempo Procesamiento | Tama√±o Resultado | Memoria Utilizada |
|---------|----------------------|---------------------|------------------|------------------|
| PDF M√©dico | 100 memos + OCR | 45-90 segundos | 5-15 MB | 1-2 GB |
| DOCX Acad√©mico | 200 memos | 30-60 segundos | 2-8 MB | 500MB-1GB |
| JSON Completo | 500 elementos | 15-30 segundos | 10-50 MB | 500MB |
| Anki Package | 100 cards + TTS | 120-300 segundos | 50-200 MB | 2-4 GB |
| CSV Dataset | 1000 registros | 10-20 segundos | 1-5 MB | 200MB |
| HTML Interactivo | 300 elementos | 60-120 segundos | 3-12 MB | 1-2 GB |

#### **Performance TTS**
| Tipo S√≠ntesis | Duraci√≥n Texto | Tiempo S√≠ntesis | Calidad Audio | Tama√±o Archivo |
|---------------|----------------|-----------------|---------------|----------------|
| Micro-memo Individual | 30-60 segundos | 5-15 segundos | 22kHz/128kbps | 500KB-2MB |
| Colecci√≥n (20 memos) | 10-20 minutos | 60-180 segundos | 22kHz/128kbps | 8-25 MB |
| Sesi√≥n Estudio (50 memos) | 25-45 minutos | 150-400 segundos | 22kHz/128kbps | 20-50 MB |
| Batch Masivo (200 memos) | 2-4 horas audio | 600-1200 segundos | 22kHz/128kbps | 100-400 MB |

#### **M√©tricas de Calidad**
| M√©trica | Target | Medici√≥n |
|---------|--------|----------|
| **Calidad TTS** | >85% naturalidad | User rating + automated metrics |
| **Pronunciaci√≥n M√©dica** | >90% t√©rminos correctos | Dictionary validation |
| **Export Fidelity** | >95% contenido preservado | Content comparison |
| **Template Consistency** | 100% formato correcto | Automated validation |
| **Processing Reliability** | >99% success rate | Error rate monitoring |

## üß™ Testing y Validaci√≥n

### **Suite de Tests Completa (15 tests)**

#### **Tests Export (8 tests)**
1. **Health Check Export Service** - Verificar templates y engines
2. **Crear Sesi√≥n Export** - Pipeline completo con configuraci√≥n
3. **Export PDF M√©dico** - Template acad√©mico con referencias
4. **Export DOCX Profesional** - Formato Word con estilos
5. **Export Anki Package** - Flashcards con audio integrado
6. **Export JSON Completo** - Estructura API preservada
7. **Export CSV Dataset** - Formato an√°lisis con m√©tricas
8. **Export HTML Interactivo** - Reporte web con funcionalidades

#### **Tests TTS (7 tests)**
1. **Health Check TTS Service** - Verificar Piper y modelos
2. **TTS Micro-memo Individual** - S√≠ntesis b√°sica con calidad
3. **TTS Colecci√≥n Completa** - Audio largo con separadores
4. **TTS Sesi√≥n Estudio** - Modo adaptativo con pausas
5. **Normalizaci√≥n Texto M√©dico** - Pre-procesamiento terminolog√≠a
6. **Batch TTS Synthesis** - Procesamiento masivo optimizado
7. **Integraci√≥n Anki + TTS** - Package completo con audio

### **Script de Testing: test_fase10_export_tts.sh**
```bash
#!/bin/bash
# Script completo de testing Fase 10

# Uso:
./scripts/test_fase10_export_tts.sh <class_session_id>
./scripts/test_fase10_export_tts.sh --export-only <class_session_id>
./scripts/test_fase10_export_tts.sh --tts-only <collection_id>
./scripts/test_fase10_export_tts.sh --full-pipeline <class_session_id>

# Tests espec√≠ficos:
./scripts/test_fase10_export_tts.sh --test export_pdf
./scripts/test_fase10_export_tts.sh --test tts_memo
./scripts/test_fase10_export_tts.sh --test anki_package
```

## üîÑ Integraci√≥n con Fases Anteriores

### **Fase 9 ‚Üí Fase 10** ‚úÖ
- **Micro-memos estructurados** listos para export y TTS
- **Colecciones organizadas** con metadata completa
- **OCR content** preparado para templates acad√©micos
- **M√©tricas completas** para analytics de export

### **Fase 8 ‚Üí Fase 10** ‚úÖ
- **Notion integration** extendida para exports y audio
- **Templates din√°micos** adaptables a nuevos formatos
- **Sincronizaci√≥n autom√°tica** de archivos generados
- **Dashboard integration** para m√©tricas de export

### **Fase 7 ‚Üí Fase 10** ‚úÖ
- **Research content** incluido en exports acad√©micos
- **Referencias m√©dicas** autom√°ticas en PDFs
- **Fuentes citadas** en formatos profesionales
- **Terminolog√≠a validada** para TTS m√©dico

### **Todas las Fases ‚Üí Export Completo** ‚úÖ
- **Pipeline completo** audio ‚Üí transcripci√≥n ‚Üí OCR ‚Üí micro-memos ‚Üí export
- **Contenido multi-modal** unificado en todos los formatos
- **M√©tricas integrales** de todo el proceso educativo
- **Knowledge management** completo para educaci√≥n m√©dica

## üöÄ Pr√≥ximos Pasos Post-Fase 10

### **Mejoras y Extensiones Futuras**
1. **Dashboard Analytics** - M√©tricas completas de uso y efectividad
2. **Mobile App Integration** - Export m√≥vil con offline sync
3. **Advanced TTS Models** - Voces personalizadas por especialidad
4. **Interactive Learning** - Gamificaci√≥n y progress tracking
5. **Enterprise Features** - Multi-tenant, admin dashboard, compliance

### **Optimizaciones de Performance**
1. **GPU Acceleration** - TTS y export acelerados por GPU
2. **Distributed Processing** - Scaling horizontal para instituciones
3. **Advanced Caching** - ML model caching y template optimization
4. **Real-time Processing** - Stream processing para exports grandes

## üìà Criterios de √âxito

### **Implementaci√≥n T√©cnica**
- ‚úÖ **100% modelos BD** implementados (2 nuevos modelos)
- ‚úÖ **100% servicios core** funcionando (export + TTS)
- ‚úÖ **100% tasks Celery** implementadas (4 tareas especializadas)
- ‚úÖ **100% endpoints API** implementados (14 endpoints)
- ‚úÖ **100% templates** creados (6 formatos + TTS)

### **Funcionalidad**
- ‚úÖ **6 formatos export** completos y funcionales
- ‚úÖ **TTS m√©dico** con pronunciaci√≥n correcta italiana
- ‚úÖ **Batch processing** optimizado para volumen
- ‚úÖ **Integraci√≥n Notion** con sincronizaci√≥n autom√°tica
- ‚úÖ **Templates profesionales** para uso acad√©mico/cl√≠nico

### **Calidad y Performance**
- ‚úÖ **Export fidelity >95%** contenido preservado
- ‚úÖ **TTS naturalidad >85%** seg√∫n m√©tricas automatizadas
- ‚úÖ **Processing time** dentro de targets especificados
- ‚úÖ **Resource efficiency** optimizado para hardware target
- ‚úÖ **Error handling** robusto con retry logic

---

**üéØ Resultado Esperado**: AxoNote se convierte en una plataforma completa de exportaci√≥n multi-modal y s√≠ntesis de voz que permite a estudiantes y profesionales m√©dicos consumir y estudiar contenido en cualquier formato preferido, desde PDFs acad√©micos hasta flashcards auditivas para estudio m√≥vil.

**üìà Impacto Final**: Completar el ecosistema de knowledge management m√©dico que transforma cualquier contenido (audio, documento, imagen) en material de estudio optimizado y accesible en m√∫ltiples modalidades, maximizando la efectividad del aprendizaje m√©dico personalizado.

---

**Estado**: üîÑ **READY FOR IMPLEMENTATION**  
**Tiempo Estimado**: 3-4 d√≠as de desarrollo  
**Dependencias**: Fase 9 completada ‚úÖ  
**Pr√≥xima Fase**: Dashboard y Analytics (Fase 11)
