# B0.1 - Fase 0: Infraestructura del Proyecto Axonote

## 📋 Resumen de la Fase

La **Fase 0** establece los cimientos del proyecto Axonote, creando toda la infraestructura necesaria para el desarrollo, testing y despliegue de la plataforma PWA de transcripción médica.

### ✅ Objetivos Completados

1. **Estructura de proyecto** siguiendo arquitectura modular
2. **Docker Compose** para desarrollo local
3. **Configuración de herramientas** (linting, formatting, testing)
4. **Archivos de configuración** para ambos stacks (Python + TypeScript)
5. **Makefile** con comandos de desarrollo optimizados
6. **Documentación base** con instrucciones completas

## 🏗️ Arquitectura Implementada

### **Estructura de Directorios**
```
axonote/
├─ apps/
│  ├─ api/                  # Backend FastAPI
│  │  ├─ app/              # Código fuente principal
│  │  │  ├─ api/           # Routers REST API
│  │  │  ├─ core/          # Config, seguridad, logging
│  │  │  ├─ models/        # Modelos SQLAlchemy
│  │  │  ├─ schemas/       # Esquemas Pydantic
│  │  │  ├─ services/      # Servicios (MinIO, Notion, LLM, etc.)
│  │  │  ├─ tasks/         # Tareas Celery para procesamiento
│  │  │  └─ workers/       # Workers Celery
│  │  ├─ alembic/          # Migraciones de base de datos
│  │  └─ pyproject.toml    # Dependencias y configuración Python
│  └─ web/                 # Frontend Next.js PWA
│     ├─ app/              # Next.js 14 App Router
│     ├─ components/       # Componentes React reutilizables
│     ├─ lib/              # Utilidades y cliente API
│     ├─ public/           # Assets estáticos y PWA manifest
│     ├─ package.json      # Dependencias Node.js
│     ├─ tailwind.config.ts # Configuración Tailwind
│     └─ tsconfig.json     # Configuración TypeScript
├─ docker/                 # Dockerfiles para cada servicio
│  ├─ api.Dockerfile       # Contenedor FastAPI
│  ├─ worker.Dockerfile    # Contenedor Celery Worker
│  └─ web.Dockerfile       # Contenedor Next.js
├─ deploy/                 # Archivos de despliegue
├─ scripts/                # Scripts de utilidad
├─ Documentacion/          # Documentación técnica con etiquetas
│  └─ B0.1-Fase-0-Infraestructura.md
├─ .gitignore             # Exclusiones Git
├─ .editorconfig          # Configuración editor
├─ docker-compose.dev.yml # Servicios para desarrollo
├─ env.example            # Variables de entorno ejemplo
├─ Makefile              # Comandos de desarrollo
└─ README.md             # Documentación principal
```

## 🐳 Servicios Docker

### **docker-compose.dev.yml**
- **PostgreSQL 15**: Base de datos principal con healthchecks
- **Redis 7**: Broker para Celery y caché
- **MinIO**: Almacenamiento de objetos para audio/archivos
- **FastAPI**: Servidor backend con hot-reload
- **Celery Worker**: Procesamiento asíncrono
- **Next.js**: Frontend PWA con hot-reload

### **Configuración de Red**
- Red personalizada `axonote_dev`
- Puertos expuestos: 3000 (web), 8000 (api), 5432 (db), 6379 (redis), 9000/9001 (minio)
- Volúmenes persistentes para datos
- Healthchecks para dependencias

## ⚙️ Configuración de Herramientas

### **Python (Backend)**
**pyproject.toml** configurado con:
- **Poetry** para gestión de dependencias
- **FastAPI** + **Uvicorn** para servidor ASGI
- **SQLAlchemy 2.0** + **Alembic** para ORM y migraciones
- **Celery** + **Redis** para tareas asíncronas
- **Pydantic 2.0** para validación de datos
- **Boto3** + **MinIO** para almacenamiento
- **Notion Client** para integración
- **Tools de desarrollo**: ruff, black, mypy, pytest

**Configuración de calidad**:
- **ruff**: Linting rápido con reglas estrictas
- **black**: Formateo automático (line-length: 88)
- **mypy**: Type checking estricto
- **pytest**: Tests con coverage ≥85%

### **TypeScript (Frontend)**
**package.json** configurado con:
- **Next.js 14** con App Router
- **React 18** + **TypeScript 5**
- **Tailwind CSS** con plugins forms/typography
- **Zustand** para gestión de estado
- **IndexedDB** (idb) para almacenamiento offline
- **Axios** para cliente HTTP
- **React Hook Form** + **Zod** para formularios
- **Framer Motion** para animaciones

**Configuración de desarrollo**:
- **ESLint**: Configuración Airbnb + TypeScript
- **Prettier**: Formateo con plugin Tailwind
- **Jest** + **Testing Library** para unit tests
- **Playwright** para E2E testing

## 🎨 Sistema de Diseño

### **Tailwind Configuration**
Paleta de colores optimizada para aplicaciones médicas:
- **Primary**: Azules profesionales (#3b82f6 family)
- **Secondary**: Verdes médicos (#22c55e family)
- **Accent**: Amarillos de alerta (#d97706 family)
- **Gray**: Escala completa para interfaz
- **Semantic**: Success, warning, error

**Características especiales**:
- Fuentes: Inter (sans) + Fira Code (mono)
- Animaciones personalizadas: fade-in, slide-up, recording
- Breakpoints responsive
- Dark mode support
- Componentes médicos específicos

## 📝 Variables de Entorno

### **Configuración Completa (env.example)**
Incluye todas las variables necesarias organizadas por categorías:

1. **FastAPI**: Puerto, host, CORS, secret key
2. **Database**: PostgreSQL connection string
3. **Redis**: URL para Celery broker/backend
4. **Storage**: MinIO/Nextcloud configuration
5. **Notion**: Token y database IDs
6. **LLM**: Providers (LM Studio, Ollama, OpenAI)
7. **ASR/Diarization**: Whisper + pyannote config
8. **OCR**: Tesseract configuration
9. **TTS**: Piper voices configuration
10. **Feature Flags**: Activación/desactivación de funcionalidades
11. **Security**: Rate limits, file sizes, allowed formats
12. **Logging**: Nivel, formato, archivos
13. **Medical Sources**: Whitelist de fuentes válidas
14. **Languages**: Configuración multiidioma
15. **GPU**: Variables NVIDIA para contenedores

## 🛠️ Makefile - Comandos de Desarrollo

### **Comandos Principales**
```bash
# Gestión de servicios
make up              # Levantar todos los servicios
make down            # Parar servicios
make logs            # Ver logs en tiempo real
make restart         # Reiniciar servicios

# Desarrollo
make format          # Formatear código (Python + TypeScript)
make lint            # Verificar estilo de código
make test            # Ejecutar todos los tests
make dev-setup       # Setup completo automático

# Base de datos
make migrate         # Aplicar migraciones
make migration       # Crear nueva migración
make db-reset        # Reset completo (⚠️ elimina datos)

# Utilidades
make shell-api       # Shell en contenedor API
make shell-db        # Conexión a PostgreSQL
make health          # Verificar salud de servicios
make clean           # Limpiar contenedores no utilizados
```

### **Workflow de Desarrollo**
1. `make dev-setup` - Setup inicial completo
2. `make format` - Antes de commits
3. `make test` - Verificar calidad
4. `make health` - Verificar servicios

## 🔧 Dockerfiles Optimizados

### **api.Dockerfile**
- **Base**: Python 3.11-slim
- **Multi-stage**: Optimizado para desarrollo/producción
- **Security**: Usuario no-root
- **Dependencies**: Poetry para gestión
- **Health**: Endpoint de salud

### **worker.Dockerfile**
- **Base**: Python 3.11-slim
- **Additional**: FFmpeg para procesamiento audio
- **Same patterns**: Consistencia con API
- **Celery**: Configuración específica

### **web.Dockerfile**
- **Base**: Node 18-alpine
- **Optimization**: npm ci para instalación rápida
- **Security**: Usuario nodejs no-root
- **Development**: Hot-reload support

## 📚 Documentación Técnica

### **Convención de Etiquetas**
- `B0.1` → Backend, Fase 0, documento 1
- Próximos ejemplos:
  - `B1.1` → Backend, Fase 1, documento 1
  - `A2.3` → App (frontend), Fase 2, documento 3

### **README.md Completo**
- Descripción técnica detallada
- Guías de instalación step-by-step
- Troubleshooting común
- Arquitectura y tecnologías
- Roadmap de desarrollo

## ✅ Checklist de Validación

### **Estructura de Proyecto**
- [x] Directorios creados según especificación
- [x] Separación clara backend/frontend
- [x] Estructura Docker organizada
- [x] Scripts y documentación ubicados

### **Configuración de Desarrollo**
- [x] pyproject.toml con todas las dependencias
- [x] package.json con stack Next.js completo
- [x] Tailwind configurado para aplicación médica
- [x] TypeScript con configuración estricta
- [x] Linting y formatting tools configurados

### **Docker Infrastructure**
- [x] docker-compose.dev.yml functional
- [x] Servicios con healthchecks
- [x] Volúmenes para persistencia
- [x] Network configuration
- [x] Environment variables setup

### **Development Tools**
- [x] Makefile con comandos esenciales
- [x] Git configuration (.gitignore, .editorconfig)
- [x] Variables de entorno documentadas
- [x] README con instrucciones completas

## 🚀 Próximos Pasos - Fase 1

Con la infraestructura completa, la **Fase 1** implementará:

1. **FastAPI Backend Base**
   - main.py con routers básicos
   - Sistema de configuración con Pydantic Settings
   - Middlewares de seguridad y logging
   - Endpoints de salud y settings

2. **Base de Datos**
   - Modelos SQLAlchemy (ClassSession, Professor, etc.)
   - Migraciones Alembic iniciales
   - Repositorios y servicios base

3. **Celery Integration**
   - Workers básicos
   - Tareas dummy para testing
   - Monitorización con Flower (opcional)

4. **Services Layer**
   - Servicio MinIO para storage
   - Servicio Notion básico
   - Stubs para LLM, ASR, OCR, TTS

## 📊 Métricas de la Fase 0

- **Archivos creados**: 15+ archivos de configuración
- **Lines of code**: ~2000 líneas (config + docs)
- **Services configured**: 6 servicios Docker
- **Dependencies**: 40+ Python packages, 25+ Node packages
- **Make targets**: 20+ comandos de desarrollo
- **Documentation**: README + documentación técnica

---

**Estado**: ✅ **Completado**  
**Siguiente**: Fase 1 - Backend Base (FastAPI + DB + Celery)  
**Tiempo estimado Fase 1**: 2-3 días de desarrollo
