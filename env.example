# ==============================================
# AXONOTE - Variables de Entorno (Ejemplo)
# ==============================================
# Copia este archivo como .env y ajusta los valores

# FastAPI Configuration
APP_ENV=dev
SECRET_KEY=your-secret-key-here-change-in-production
API_PORT=8000
API_HOST=0.0.0.0
CORS_ORIGINS=http://localhost:3000

# Database Configuration
DATABASE_URL=postgresql+psycopg://postgres:postgres@db:5432/medclass
DATABASE_ECHO=false

# Redis Configuration (para Celery)
REDIS_URL=redis://redis:6379/0
CELERY_BROKER_URL=redis://redis:6379/0
CELERY_RESULT_BACKEND=redis://redis:6379/1

# MinIO / Object Storage Configuration
STORAGE_BACKEND=minio
MINIO_ENDPOINT=minio:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
MINIO_BUCKET=recordings
MINIO_SECURE=false

# Nextcloud Configuration (alternativa a MinIO)
# NEXTCLOUD_URL=https://your-nextcloud.com
# NEXTCLOUD_USERNAME=your-username
# NEXTCLOUD_PASSWORD=your-password
# NEXTCLOUD_FOLDER=recordings

# Notion Integration
NOTION_TOKEN=secret_xxx
NOTION_DB_CLASSES=
NOTION_DB_SOURCES=
NOTION_DB_TERMS=
NOTION_DB_CARDS=

# LLM Configuration
LLM_PROVIDER=lmstudio                    # lmstudio | ollama | openai
LMSTUDIO_BASE_URL=http://lmstudio:1234
OLLAMA_BASE_URL=http://ollama:11434
LLM_MODEL_NAME=qwen2.5-14b-instruct
LLM_MAX_TOKENS=4000
LLM_TEMPERATURE=0.1

# OpenAI Fallback Configuration
OPENAI_API_KEY=                          # Opcional
OPENAI_MODEL=gpt-4o-mini
OPENAI_MAX_MONTHLY_COST=25.0            # Límite en EUR

# Post-procesamiento y Análisis LLM
ENABLE_ASR_CORRECTION=true
ASR_CONFIDENCE_THRESHOLD=0.8
MEDICAL_DICT_PATH=data/medical_dict_it.json

# NER Médico
ENABLE_MEDICAL_NER=true
NER_CONFIDENCE_THRESHOLD=0.8
NER_INCLUDE_DEFINITIONS=true

# Análisis de estructura
ENABLE_STRUCTURE_ANALYSIS=true
STRUCTURE_MIN_SEGMENT_SEC=30

# Calidad y validación
QUALITY_MIN_COHERENCE=0.7
QUALITY_MIN_COMPLETENESS=0.6
AUTO_REVIEW_THRESHOLD=0.8
ENABLE_QUALITY_GATES=true

# ASR (Automatic Speech Recognition) Configuration
WHISPER_MODEL=large-v3                   # tiny, base, small, medium, large-v3
WHISPER_DEVICE=cuda                      # cuda, cpu
WHISPER_COMPUTE_TYPE=float16             # float16, int8, int8_float16
USE_WHISPERX=true                        # Alineación de palabras
VAD_FILTER=true                          # Voice Activity Detection

# Diarization Configuration (Speaker Separation)
USE_DIARIZATION=true
DIARIZATION_MODEL=pyannote/speaker-diarization-3.1
HF_TOKEN=                                # Hugging Face token para pyannote (requerido)

# Processing Configuration
MAX_PROCESSING_TIME_MINUTES=120          # Timeout máximo para procesamiento
ENABLE_AUDIO_NORMALIZATION=true         # Normalizar audio antes de ASR
PROCESSING_CHUNK_SIZE_SEC=600           # Tamaño de chunks para audio largo (10 min)

# OCR Configuration
TESSERACT_LANG=ita+eng                   # Idiomas: ita, eng, spa, etc.
TESSDATA_PREFIX=/usr/share/tesseract-ocr/4.00/tessdata
OCR_DPI=300
OCR_PSM=3                                # Page Segmentation Mode

# TTS (Text-to-Speech) Configuration
PIPER_VOICE_ES=es_ES-mls_10246-medium    # Voz en español
PIPER_VOICE_IT=it_IT-riccardo-x_low      # Voz en italiano
PIPER_BIN=/usr/local/bin/piper
TTS_SAMPLE_RATE=22050

# Feature Flags
FEATURE_PROFESSOR_ENTITY=true            # Auto-crear entidad profesor
FEATURE_STRICT_JSON=false                # Validador JSON tolerante
FEATURE_REMOTE_TURBO=false               # Usar OpenAI cuando disponible
FEATURE_CALENDAR_INTEGRATION=false       # CalDAV/ICS (futuro)
FEATURE_OCR=true                         # OCR de pizarra/diapositivas
FEATURE_TTS=true                         # Text-to-Speech
FEATURE_BATCH_REPROCESS=true             # Reprocesamiento en lotes

# Security Configuration
RATE_LIMIT_PER_MINUTE=60
MAX_UPLOAD_SIZE_MB=500
ALLOWED_AUDIO_FORMATS=wav,mp3,m4a,flac,ogg
ALLOWED_IMAGE_FORMATS=jpg,jpeg,png,webp

# Logging Configuration
LOG_LEVEL=INFO                           # DEBUG, INFO, WARNING, ERROR
LOG_FORMAT=json                          # json, text
LOG_FILE=/app/logs/axonote.log

# Medical Sources Whitelist (separados por coma)
ALLOWED_MEDICAL_SOURCES=who.int,ecdc.europa.eu,cdc.gov,nih.gov,pubmed.ncbi.nlm.nih.gov,nice.org.uk,ema.europa.eu,cochrane.org

# Language Configuration
DEFAULT_SOURCE_LANGUAGE=it               # Idioma principal de las clases
OUTPUT_LANGUAGE=es                       # Idioma de salida (resúmenes)
SUPPORTED_LANGUAGES=it,en,es

# Processing Configuration
MAX_CONCURRENT_TRANSCRIPTIONS=2
CHUNK_SIZE_SECONDS=30
AUDIO_SAMPLE_RATE=16000
AUDIO_CHANNELS=1

# Monitoring and Analytics
ENABLE_METRICS=true
METRICS_RETENTION_DAYS=90
ERROR_REPORTING=true

# Development Configuration (solo para desarrollo)
DEBUG=false
HOT_RELOAD=true
ENABLE_SWAGGER=true
ENABLE_REDOC=true

# GPU Configuration (para docker-compose.gpu.yml)
NVIDIA_VISIBLE_DEVICES=all
NVIDIA_DRIVER_CAPABILITIES=compute,utility

# Backup Configuration
BACKUP_ENABLED=false
BACKUP_SCHEDULE=0 2 * * *                # Cron: diario a las 2:00 AM
BACKUP_RETENTION_DAYS=30
BACKUP_S3_BUCKET=
BACKUP_S3_ACCESS_KEY=
BACKUP_S3_SECRET_KEY=
